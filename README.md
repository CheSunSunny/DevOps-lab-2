# Лабораторная работа 2
Возьмем пример с контейнеризацией какой-то обученной ml модели.

FROM ubuntu:latest

RUN apt-get update 
RUN apt-get install -y python3.11 python3-pip

WORKDIR /app

COPY predict.py .
COPY model.pkl .
COPY requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

#подразумевается что prtdict.py отслеживать stdin
CMD ["python3", "predict.py"]

Исправленная версия:

FROM  python:3.11-slim

WORKDIR /app

COPY predict.py .
COPY model.pkl .
COPY requirements.txt .

RUN pip install --no-cache-dir -r requirements.txt

RUN groupadd -r appuser && useradd -r -g appuser appuser
RUN chown -R appuser:appuser /app
USER appuser

ENTRYPOINT ["python3", "predict.py"]

Что изменилось:

1. Стандартный образ ubuntu предоставляет широкий функционал и пространство для взаимодействия пользователя с контейнером. Возможно, он мог бы пригодиться в начале докерфайла для крупного проекта, где пригодились бы разные настройки, пакеты, а следовательно, и многостадийная сборка. Но для работы модели не нужен полный образ ubuntu, или даже обычный python образ, поэтому берем потенциально минимальный, для оптимизации использования памяти.
2. В данном случае потенциальному пользователю не необходимы права root в контейнере, их следует ограничить из общих соображений потенциального ущерба уязвимостей кода или пакетов. Во второй версии пространства для потенциальной атаки  сокращено.
3. При использовании CMD есть возможность поменять команды в интерактивном режиме. При этом сущность модели не предполагает дообучения, а взаимодействие с ней происходит благодаря логике predict.py - контейнер предназначен для выполнения одной задачи. Поэтому, чтобы исключить потенциальное взаимодействие с контейнером (тут скорее с точки зрения ошибки пользователя, нежели из соображений безопасности), заменим CMD на ENTRYPOINT. 

Плохие практики работы с контейнерами:
1. Подключать автоматический запуск всех или даже немногих потенциально полезных приложений в контейнерах при запуске системы. Оперативной памяти не всегда бывает много, а при большом количестве разного рода задач можно и не заметить лишний раз, что на фоне есть запущенные контейнеры. Кроме того, на некоторых системах из-за этого могут потенциально возникать конфликты при дублировании  классическим образом установленных приложений и приложений в контейнерах.
